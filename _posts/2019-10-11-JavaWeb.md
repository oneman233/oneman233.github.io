---
layout: post
title: "JavaWeb"
date: 2019-10-11
tags: ["学习笔记"]
comments: true
author: oneman233
excerpt: "前端"
---

* 什么是Java Server Pages?
  * JSP可以动态地修改页面，可以在HTML中插入JAVA代码。
* JSP的action必须使用类似./servlet的方式调用servlet，并且servlet的url必须设置为/servlet
  * servlet必须继承自httpservlet
* 获取系统时间的写法：
  
    ```java
    SimpleDateFormat df=new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    Date d=new Date();
    String date=df.format(d);
    ```

* 转发时在request当中新建键值对的写法：

    ```java
    //转发到results页面
    req.setAttribute("deng","转发成功");
    //在request里面加入一个键值对，便于在转发后的servlet中进行测试
    req.getRequestDispatcher("/results").forward(req,resp);
    ```

* [application的一些用法](https://blog.csdn.net/CCCrunner/article/details/81052373)

* 用于中文转码的函数：

    ```java
    private String change(String s) throws UnsupportedEncodingException {
        return new String(s.getBytes("ISO8859-1"),"UTF-8");
    }
    ```

* [textarea标签相关](https://www.runoob.com/tags/tag-textarea.html)

* application是一种“全局变量”，可以从request中获取session之后获得，并且可以用set方便地改变键值对。
  * 如果没有request，那么在JSP文件中的application将为null

* session会话机制是一种服务器端机制，它使用类似于哈希表的结构来保存信息。

* jsp可以在java代码中穿插HTML：
  
    ```js
    <%ArrayList list=(ArrayList) application.getAttribute("list");
        if(list==null||list.size()==0) {
        out.print("暂无留言");
        } else {
            for(int i=0;i<list.size();++i){
                out.print("标题："+m.getTitle()+"\n");
                out.print("内容："+m.getContent()+"\n");
                out.print("时间："+m.getTime()+"\n");
    %>
        <%--在java代码中间穿插的html语言--%>
        留言者：<%=m.getName()%>
        留言标题：<%=m.getTitle()%>
        留言时间：<%=m.getTime()%>
        留言内容：<%=m.getContent()%>
    <%       
            }     
        } 
    %>
    ```

* 注意新建了Tomcat还要新建Artificial，否则会报找不到路径：
  * [新建Tomcat](https://blog.csdn.net/wsjzzcbq/article/details/89463304)
  * [新建Artificial](https://bbs.csdn.net/topics/392299968)

* [关于找不到servlet包](https://blog.csdn.net/q343509740/article/details/79515911)
  * 使用第一个解决方案的project structure即可

* [关于HTML标签](https://www.runoob.com/html/html-forms.html)

* [报Cannot forward after response has been committed错误](https://www.cnblogs.com/WyaJx/p/7823723.html)
  * 去除super，并且写上return。

* [servlet转发](https://www.cnblogs.com/flypig666/p/11480537.html)
  * 通过request对象获取请求转发器对象：`RequestDispatcher getRequestDispatcher(String path)`
  * 使用RequestDispatcher对象来进行转发：`forward(ServletRequest request, ServletResponse response)`

* 记得转发一个Arraylist给JSP，因为在JSP中调用Message类不能实现，会涉及到很多包的问题。
  * 记得放到同一个package下

* [基本教程](https://blog.csdn.net/csp_6666/article/details/78509088)

* [sevlet基本使用](https://www.runoob.com/servlet/servlet-form-data.html)

* [关于double转string](https://blog.csdn.net/wishchin/article/details/78399552)
  * 似乎使用parsedouble更合适

* java string判断相等用equal方法

* 如何在显示结果页面返回主页面？
  * 放置一个超链接即可。

* [不要乱去调用super函数，会导致很多憨批错误](https://blog.csdn.net/sinat_33537942/article/details/80625572)

* [Java如何处理带双引号的字符串](https://blog.csdn.net/weixin_39128119/article/details/82762348)

* [调IDEA背景颜色](https://jingyan.baidu.com/article/63acb44a1da58761fcc17e86.html)

* 解决乱码（如果表单提交的数据中有中文数据则需要转码）：

    ```java
    String name =new String(request.getParameter("name").getBytes("ISO8859-1"),"UTF-8");
    ```

* 单选框设置默认选项用selected，radio则使用checked。

* [Java的Map用法](https://blog.csdn.net/qq_29373285/article/details/81487594)

* **value属性最好不用中文**，远离乱码困扰。

* 设置背景图片：

    ```css
    body
    {
        background-image: url('image/back.png');
        /此处的根目录是web根目录，别加反斜杠/
    }
    ```

* 为了把超链接居中，可以直接更改段落格式，然后把href设为段落。
  * 直接更改似乎不可行。

* 更改字体和字符大小：

    ```css
    p
    {
        font-weight: bold;
        font-family: 'Times New Roman', Times, Serif;
        font-size: 20px;
        color: red;
        text-align: center;
    }
    textarea
    {
        font-size: 10px;
        font-family: 'Times New Roman', Times, Serif;
        text-align: center;
    }
    ```

* 加粗字体：`font-weight: bold;`

* 如何修改链接属性（甚至可以设置为鼠标移动上去时才显示下划线）：

    ```css
    a:link{
        color: blueviolet;
        text-decoration: none;
    }/未访问链接/
    a:visited{
        color: darkgreen;
        text-decoration: none;
    }/已访问链接/
    a:hover{
        color: darkgoldenrod;
        text-decoration: underline;
    }/鼠标移动到链接上/
    ```

* 对textarea的调整：

    ```css
    width: 200px;
    height: 100px;
    border: solid 1px;
    border-radius: 20px;
    resize: none;
    background-color: darkslategrey;
    /*设置了长宽，圆角有边框，不可调整大小，设置了背景颜色*/
    ```

* 对input的字体和被选中效果的调整：

    ```css
    input
    {
        color: crimson;
    }
    input:hover
    {
        background-color: lawngreen;
    }
    ```

* **小心绝对路径和相对路径的区别**。

* [JSTL](https://www.runoob.com/jsp/jsp-jstl.html)

    [EL](https://www.runoob.com/jsp/jsp-expression-language.html)

* **F12调试工具application可以删除cookie**。

* 判断是否存在cookie（所有EL必须写在大括号里！）：

    ```js
    <c:if test="${cookie['username'].value eq null}">
        <c:redirect url="loginJSP.jsp"></c:redirect>
    </c:if>
    ```

* 更改cookie：

    ```java
    Cookie cookie=new Cookie("username",name);
        //新建cookie
        resp.addCookie(cookie);
        //添加cookie
        req.getRequestDispatcher("index.jsp").forward(req, resp);
        resp.sendRedirect("index.jsp");
        //存在cookie之后就不需要req了
    ```

* IDEA可以使用alt+insert快速创建构造函数以及geter，seter。

* 删除cookie：

    ```java
    Cookie cookie = new Cookie("username",null);
        cookie.setMaxAge(0);
        //最大生存时间0
        resp.addCookie(cookie);
        resp.sendRedirect("index.jsp");
    ```

* 注解标准写法：

    ```java
    @WebServlet(name = "main", urlPatterns = "/main")
    ```

* 可以直接修改List来传递参数，数据存储在session当中，只有用户名保存在cookie，get方法可以方便地获得下标。

    ```java
    int id=Integer.parseInt(req.getParameter("id"));
        //文章下标
        ArrayList reply = (ArrayList) context.getAttribute("reply");
        //reply是一个ArrayList
        Article article = reply.get(id);
        req.setAttribute("article",article);
        //提交文章
        req.getRequestDispatcher("outputJSP.jsp").forward(req, resp);
    ```

* reply必须判断是否存在。

    ```java
    if(reply == null) reply = new ArrayList();
    ```

* el表达式调用的是getter和setter方法，比如调用getAlbum_id的就是获取item.album_id的值，就是说去掉get然后将首字母大写变成小写。

* 一种在前端遍历reply的写法：

    ```js
    <c:forEach var="item" items="${applicationScope.albumlist}">
    <%--  为了获取下标，可以创建临时变量：--%>
    <c:set var="cnt" value="0" scope="request"/>
    <%--  并且每一次循环都：--%>
    <c:set var="cnt" value="${requestScope.cnt+1}" scope="request"/>
    <%--  调用的时候一直在request作用域内调用就好--%>
    ```

* 不用担心string和int，前端+1返回的总是int，在servlet中parseint即可。

* 超链接居中：
    
    ```html
    <div align="center">...</div>
    ```

* 每次更新CSS要么修改文件名，要么加入版本号，否则无效。

* HTML空格符：`& nbsp;`

* 转发给另一个页面的方法（可以用在index当中）：

    ```html
    <jsp:forward page="login.jsp"></jsp:forward>
    ```

* 单选框的使用：

    ```html
    <input type="radio" name="identity" value="student" checked>
                    学生
    <input type="radio" name="identity" value="teacher">
                    教师
    <input type="radio" name="identity" value="admin">
                    管理员
    <!-- name是单选框的名字，value是各个框对应的值，checked是设定默认登陆身份防止未选中就登陆 -->
    ```

* 数据库连接池是预先创建好Connection，以应对高并发的数据访问，避免创建大量无用的Connection。

* 表单当中submit或reset显示的文字用value属性修改：

    ```html
    <input type="reset" value="清空">
    ```

* input大小可以用height和width属性来修改。

* 把数据池的get写成静态方法可以做到“全局调用”。
  * 含有静态方法的类不要写构造函数，用static代码块包裹构造函数，第一次加载的时候会被调用：
        ```java
        static {
                System.out.println("数据池被调用");
                //在这里写构造函数
            }
        ```

* PreparedStatement的写法：

    ```java
    /*
    private String check_login_sql = "select password from ? where username = ?";
    private PreparedStatement prestmt = null;
    private Connection con = null;
    */
    //以上为变量定义
    con = DataSource.getConnection();
    prestmt = con.prepareStatement(check_login_sql);
    prestmt.setString(1,identity);
    prestmt.setString(2,username);
    resultSet = prestmt.executeQuery();
    ```

* 读取结果集的方法：

    ```java
    while(rs.next()){
        int id = rs.getInt("id");
        String name = rs.getString("name");
        String gender = rs.getString("gender");
    }
    // 调用不同的get方法即可
    ```

* java中要使用单引号的时候可以考虑使用`" ' "`，这样可以把它当作普通字符串进行拼接。

* prestatement不能替代表名，因为其setString方法会在前后自动加上单引号。

* 在java后台中获取cookie：

    ```java
    req.setCharacterEncoding("UTF-8");
        resp.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html;charset=UTF-8");
        //处理中文
    HttpSession session=req.getSession();
            //获取session
            ServletContext context=session.getServletContext();
            //获取储存在上下文中的实例
            Cookie[] cookies = req.getCookies();
            String name=new String();
            for (Cookie cookie:cookies) {
                if(cookie.getName().equals("username")){
                    name=cookie.getValue();
                    break;
                }
            }
            //获取用户名
    ```

* 页面跳转的问题
  * 让本页转向新的页面：

    ```html
    <input type=button onclick=”window.location.href(‘连接’)“>
    ```
  * 打开一个新的页面进行转向：

    ```html
    <input type=button onclick=”window.open(‘连接’)“>
    ```
  * 关于刷新、前进和后退：

    ```html
    <input type=button value=刷新 onclick=”window.location.reload()“>
    <input type=button value=前进 onclick=”window.history.go(1)“>
    <input type=button value=刷新 onclick=”window.history.go(0)“>
    <input type=button value=后退 onclick=”window.history.go(-1)“>
    <input type=button value=前进 onclick=”window.history.forward()“>
    <input type=button value=后退 onclick=”window.history.back()“>
    <input type=button value=后退+刷新 onclick=”window.history.go(-1);window.location.reload()“>
    ```

* 检查两次输入密码是否相等：

    ```html
    <script>
        function check() {
            var new_pass = document.getElementById("new_pass");
            var new_pass_repeat = document.getElementById("new_pass_repeat");
            if(new_pass.value !== new_pass_repeat.value) {
                alert("您两次输入的密码不一致！");
                document.forms[0].reset();
            } else {
                document.forms[0].submit();
            }
        }
    </script>
    <input type="button" value="提交" onclick="check()">
    ```

* onclick是被点击时做出的行动，可以用document里的form来获取每一个表单，但是最后比较的时候应当使用value。
  * 利用onclick可以放弃submit和reset。
  * 除此之外，最好使用getById，这样可以获得一个确定的值，id可以在input里面设置：

    ```html
    <input id="new_pass" type="password" name="new_pass"/>
    ```

* 在javascript判断两个变量值是否相等，可以使用 ==（等同）操作符 或者 ===（恒等）操作符。
  * “等同”操作符，简单判断2个变量值是否相等，变量类型不一致时，会做类型转换，即忽略变量的类型进行比较。
  * “恒等”操作符，先比较2个变量类型是否一致，不一致返回false，一致时，再比较2个变量的值是否相等。

* 判断结果集为空不能用`==null`，应该判断`if(resultSet.next())`。

* 在jstl当中传递消息需要使用如下格式：
    
    ```js
    ${pageContext.request.setAttribute("where","course")}
    ```

* 每次访问页面都刷新一次数据库的方法：设定一个变量：

    ```js
    <c:if test="${requestScope.searched eq null}">
            <jsp:forward page="/adminget"/>
        </c:if>
        ${pageContext.request.setAttribute("searched",null)}
    ```

* get方法传多个参数用`&`分隔，开始用`?`标识。

* update的用法：

    ```sql
    UPDATE teacher SET `name`='Chen' WHERE username='tea3';
    ```

* 可以设置value来更改输入框默认值：
  
    ```html
    First name: <input type="text" name="fname" value="George" /><br />
    ```

* 多行输入就不能使用Input了，需要使用textarea标签。

* post方法也可以在url当中加入参数。

* textarea的默认值直接用标签包裹起来即可。

* 确认删除的写法：

    ```js
    function del() {
            if (!confirm("确认要删除？")) {
                window.event.returnValue = false;
            }
        }
    \\ 可以直接套在submit的onclick里
    ```

* 解决CSS不刷新办法：Ctrl+F5强制刷新页面，重新加载资源。

* resize : none，此时用户不可以调节元素的宽和高。
  * 可以用在任意元素上，一般和textarea一起用，让textarea不可拉伸。

* text-align=center 让文本居中显示
font-family 修改字体
font-size 修改字体大小

* jsp页面以及css等属于静态资源，可以只更新静态资源而不重启服务器。

* 创建选项列表：

    ```html
    <select>
    <option value ="volvo">Volvo</option>
    <option value ="saab">Saab</option>
    </select>
    ```

* form[0]提交没反应：
  * 只写了input标签 没有form标签
  * id不全，有些属性在js脚本中没有获取到

* jstl的switchcase语句：

    ```html
    <c:choose>
    <c:when test="">
    
    </c:when>
    <c:otherwise>

    </c:otherwise>
    </c:choose>
    <!-- 但是实际上并不好用，我用了两个互斥的if代替了他们 -->
    ```

* **listener要注册**。

* 上下分屏的写法：

    ```html
    <frameset rows="50%,50%">
        <frame src="input.jsp">
        <frame src="output.jsp">
    </frameset>
    ```

* java里的map叫hashmap，put方法可以修改键值，foreach可以遍历map：

    ```java
    mp.put(username,now);
                mp.forEach((key,value) -> {
                    if(Math.abs(value-now) >= 10){
                        mp.remove(key);
                    }
                });
    ```

* 写在listener里面的context只能用自带的ServletRequestEvent参数来获取，否则会获取到null。

* `/*.jsp` 过滤器会过滤所有对jsp的访问
`/message/*` 过滤器会过滤所有message文件夹内的文件的访问
  * 过滤器可以对提交的所有中文数据编码进行更改，不需要在每个servlet里面去写，也可以判断有没有正常登陆（登陆页面需要做这个判断）

* src是路径，alt是图像的替代文本：

    ```html
    <img src="${pageContext.request.contextPath}/image/sky.jpg" alt="sky">
    ```
